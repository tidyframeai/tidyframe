# TidyFrame Backend Environment Configuration
# Copy this file to .env and fill in the values
# CRITICAL: Never commit .env with real values to version control

# =============================================================================
# ENVIRONMENT SETTINGS
# =============================================================================
ENVIRONMENT=development  # Options: development, production
DEBUG=False  # Set to False in production
LOG_LEVEL=INFO  # Options: DEBUG, INFO, WARNING, ERROR, CRITICAL

# =============================================================================
# SECURITY - CRITICAL: MUST BE SET
# =============================================================================
# Generate SECRET_KEY with: python -c "import secrets; print(secrets.token_urlsafe(64))"
SECRET_KEY=your-secret-key-here-minimum-32-characters-long

# JWT Configuration
ACCESS_TOKEN_EXPIRE_MINUTES=1440  # 24 hours
REFRESH_TOKEN_EXPIRE_MINUTES=43200  # 30 days
JWT_ALGORITHM=HS256

# Password Requirements
PASSWORD_MIN_LENGTH=12
PASSWORD_REQUIRE_UPPERCASE=True
PASSWORD_REQUIRE_LOWERCASE=True
PASSWORD_REQUIRE_DIGIT=True
PASSWORD_REQUIRE_SPECIAL=True

# Login Security
MAX_LOGIN_ATTEMPTS=5
LOCKOUT_DURATION_MINUTES=30

# =============================================================================
# DATABASE CONFIGURATION
# =============================================================================
# Format: postgresql+asyncpg://user:password@host:port/database
DATABASE_URL=postgresql+asyncpg://tidyframe:password@localhost:5432/tidyframe
DATABASE_POOL_SIZE=10
DATABASE_MAX_OVERFLOW=20
DATABASE_POOL_PRE_PING=True

# =============================================================================
# REDIS CONFIGURATION
# =============================================================================
REDIS_URL=redis://localhost:6379/0
REDIS_CACHE_TTL=3600  # 1 hour

# =============================================================================
# GOOGLE GEMINI API (Required for AI Name Parsing)
# =============================================================================
# Get your API key from: https://makersuite.google.com/app/apikey
GEMINI_API_KEY=your-gemini-api-key-here
GEMINI_MODEL=gemini-2.5-flash
GEMINI_FALLBACK_MODEL=gemini-2.5-flash
GEMINI_MAX_CONCURRENT=20
GEMINI_RATE_LIMIT_PER_MINUTE=60
GEMINI_TIMEOUT_SECONDS=30

# Google OAuth (Optional)
GOOGLE_CLIENT_ID=your-google-client-id
GOOGLE_CLIENT_SECRET=your-google-client-secret

# =============================================================================
# STRIPE CONFIGURATION (Required for Paid Plans)
# =============================================================================
# Get your keys from: https://dashboard.stripe.com/apikeys
STRIPE_SECRET_KEY=sk_test_your-stripe-secret-key
STRIPE_PUBLISHABLE_KEY=pk_test_your-stripe-publishable-key
STRIPE_WEBHOOK_SECRET=whsec_your-webhook-secret
STRIPE_BILLING_METER_WEBHOOK_SECRET=whsec_your-meter-webhook-secret

# Stripe Product/Price IDs (Create in Stripe Dashboard)
STRIPE_STANDARD_MONTHLY_PRICE_ID=price_your-monthly-price-id
STRIPE_STANDARD_YEARLY_PRICE_ID=price_your-yearly-price-id
STRIPE_ENTERPRISE_MONTHLY_PRICE_ID=price_your-enterprise-monthly-id
STRIPE_ENTERPRISE_YEARLY_PRICE_ID=price_your-enterprise-yearly-id
STRIPE_OVERAGE_PRICE_ID=price_your-overage-price-id
STRIPE_PRODUCT_ID=prod_your-product-id

# Stripe Meter Configuration (CRITICAL FOR OVERAGE BILLING)
# Event name for reporting usage (configured when creating meter in Stripe)
STRIPE_METER_EVENT_NAME=your-meter-event-name
# Meter ID for reading summaries (get from Stripe Dashboard or run discover_stripe_setup.py)
STRIPE_METER_ID=mtr_your-meter-id

# =============================================================================
# EMAIL CONFIGURATION
# =============================================================================
# Get your API key from: https://resend.com
RESEND_API_KEY=re_your-resend-api-key
FROM_EMAIL=noreply@tidyframe.com
SUPPORT_EMAIL=support@tidyframe.com

# =============================================================================
# FRONTEND URL (Environment-Aware)
# =============================================================================
# Development: http://localhost:3000
# Production: https://tidyframe.com
FRONTEND_URL=http://localhost:3000

# =============================================================================
# CORS AND ALLOWED HOSTS
# =============================================================================
# Comma-separated list of allowed hosts (or "*" for all)
# Production example: tidyframe.com,www.tidyframe.com,api.tidyframe.com
ALLOWED_HOSTS_STR=*

# =============================================================================
# SITE PASSWORD PROTECTION (Pre-Launch)
# =============================================================================
ENABLE_SITE_PASSWORD=False
SITE_PASSWORD=your-site-password-here

# =============================================================================
# ADMIN CONFIGURATION
# =============================================================================
ADMIN_EMAIL=admin@tidyframe.com
ADMIN_PASSWORD=your-secure-admin-password-here

# =============================================================================
# FILE UPLOAD SETTINGS
# =============================================================================
MAX_FILE_SIZE_MB=200
ANONYMOUS_MAX_FILE_SIZE_MB=1
UPLOAD_DIR=/app/uploads
RESULTS_DIR=/app/results
VIRUS_SCANNING_ENABLED=True

# =============================================================================
# PROCESSING LIMITS AND BILLING
# =============================================================================
# Standard Tier (100k names included)
STANDARD_TIER_MONTHLY_LIMIT=100000
STANDARD_MONTHLY_PRICE=80.0
STANDARD_YEARLY_PRICE=768.0  # 20% discount
STANDARD_OVERAGE_PRICE=0.01  # $0.01 per name over limit

# Enterprise Tier
ENTERPRISE_TIER_MONTHLY_LIMIT=10000000

# Anonymous Trial
ANONYMOUS_LIFETIME_LIMIT=5  # Free parses per IP (lifetime)

# Processing
MAX_ROWS_PER_FILE=1000000
PROCESSING_TIMEOUT_MINUTES=60
BATCH_SIZE=8  # Optimized for gemini-2.5-flash thinking tokens (~250-300 per name, need smaller batches)

# =============================================================================
# FILE RETENTION (SECURITY)
# =============================================================================
# All processed files are automatically deleted after this duration
POST_PROCESSING_RETENTION_MINUTES=10

# =============================================================================
# RATE LIMITING
# =============================================================================
RATE_LIMIT_PER_MINUTE=60
API_RATE_LIMIT_PER_MINUTE=1000

# =============================================================================
# SECURITY HEADERS
# =============================================================================
ENABLE_SECURITY_HEADERS=True
ENABLE_HSTS=True  # Only in production
ENABLE_CSP=True
COOKIE_SECURE=True  # HTTPS only
COOKIE_HTTPONLY=True
COOKIE_SAMESITE=lax

# =============================================================================
# MONITORING AND LOGGING
# =============================================================================
ENABLE_METRICS=True
ENABLE_REQUEST_LOGGING=True
LOG_SENSITIVE_DATA=False  # Never log passwords, tokens
BLOCK_SUSPICIOUS_REQUESTS=True

# Optional: Sentry DSN for error tracking
SENTRY_DSN=

# =============================================================================
# CACHING
# =============================================================================
ENABLE_CACHING=True
CACHE_TTL_SECONDS=3600

# =============================================================================
# CELERY (Background Tasks)
# =============================================================================
# Derived from REDIS_URL automatically
# CELERY_BROKER_URL will use REDIS_URL/1
# CELERY_RESULT_BACKEND will use REDIS_URL/2
CELERY_TASK_SERIALIZER=json
CELERY_RESULT_SERIALIZER=json
CELERY_TIMEZONE=UTC
CELERY_ENABLE_UTC=True
